<%- include('../layouts/user/product-header') %>

  <style>
    body {
      font-family: 'Montserrat', sans-serif;
    }

    /* Container Styling */
    .path {
      display: flex;
      flex-direction: column;
      align-items: start;
      padding: 25px;
      background-color: #f9f9f9;
      border-radius: 8px;
      width: 300px;
      /* Increased width */
      font-family: Arial, sans-serif;
      margin-right: auto;
      margin-top: 10px;
      margin-bottom: 50px;
      height: 500px;
    }

    /* Link Styling */
    .path a {
      color: #333;
      text-decoration: none;
      font-size: 20px;
      /* Increased font size */
      font-weight: 300;
      padding: 12px 0;
      /* Slightly larger padding */
      transition: color 0.3s ease;
    }

    /* Hover and Active Link */
    .path a:hover {
      color: #007bff;
    }

    .path a[style*="color: red;"] {
      color: #dc3545;
    }

    /* Separator Line Styling */
    .path .separator {
      width: 100%;
      height: 1px;
      background-color: #e0e0e0;
      margin: 6px 0;
    }


    .wallet-container {
      margin-top: 10px;
      background-color: #f8f9fa;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      padding: 20px;
      margin-bottom: 50px;
    }

    .balance-box {
      background-color: #f8f9fa;
      border: 1px solid #e9ecef;
      border-radius: 8px;
      padding: 20px;
      text-align: center;
      animation: fadeIn 1s ease-in-out;
    }

    .balance-box h3 {
      margin: 0;
      font-size: 24px;
      color: #333;
    }

    .transaction-list {
      margin-top: 30px;
      max-height: 200px;
      overflow-y: auto;
    }

    .transaction-item {
      background-color: #fff;
      border: 1px solid #e9ecef;
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      animation: slideIn 0.5s ease-in-out;
    }

    .transaction-item:nth-child(even) {
      animation-delay: 0.1s;
    }

    .transaction-item:nth-child(odd) {
      animation-delay: 0.2s;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
      }

      to {
        opacity: 1;
      }
    }

    @keyframes slideIn {
      from {
        transform: translateY(20px);
        opacity: 0;
      }

      to {
        transform: translateY(0);
        opacity: 1;
      }
    }

    .btn {
      font-size: 16px;
      padding: 10px 20px;
      border-radius: 50px;
      transition: all 0.3s;
    }

    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    }

    .text-red {
      color: red;
    }

    .text-green {
      color: green;
    }

    /* Table Styling */
    .table {
      width: 100%;
      margin-top: 20px;
      border-collapse: collapse;
    }

    .table th,
    .table td {
      padding: 12px;
      text-align: center;
      /* Center-align content in each cell */
      vertical-align: middle;
    }

    .table th {
      font-weight: bold;
      background-color: #f2f2f2;
      /* Light background for headers */
      border-bottom: 2px solid #ddd;
    }

    .table td {
      border-bottom: 1px solid #ddd;
    }

    .transaction-list {
      max-height: 300px;
      /* Adjust as needed */
      overflow-y: auto;
      /* Enable scroll if content overflows */
    }

    .pagination {
    margin-bottom: 20px;
}

.page-link {
    color: #333;
    border: 1px solid #dee2e6;
    padding: 8px 12px;
}

.page-item.active .page-link {
    background-color: #007bff;
    border-color: #007bff;
    color: white;
}

.page-link:hover {
    color: #0056b3;
    text-decoration: none;
    background-color: #e9ecef;
    border-color: #dee2e6;
}

.transaction-list {
    max-height: none;
    overflow-y: visible;
}
  </style>

  </head>
  <!-- Breadcrumb Begin -->
  <div class="container">
    <div class="bread-crumb flex-w p-t-10 p-r-15 p-lr-0-lg p-b-10">
      <a href="/" class="stext-109 cl8 hov-cl1 trans-04">
        Home
        <i class="fa fa-angle-right m-l-9 m-r-10" aria-hidden="true"></i>
      </a>

      <a href="/user-profile" class="stext-109 cl8 hov-cl1 trans-04">
        User profile
        <i class="fa fa-angle-right m-l-9 m-r-10" aria-hidden="true"></i>
      </a>

      <a href="#" class="stext-109 cl8 hov-cl1 trans-04">
        Wallet
        <i class="fa fa-angle-right m-l-9 m-r-10" aria-hidden="true"></i>
      </a>
    </div>
  </div>
  <!-- Breadcrumb End -->

  <div class="modal fade" id="addMoneyModal" tabindex="-1" role="dialog" aria-labelledby="addMoneyModalLabel"
    aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="addMoneyModalLabel">Add Money</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <form action="/add-money" method="post">
          <div class="modal-body">
            <div class="form-group">
              <label for="addAmount">Amount</label>
              <input type="number" class="form-control" id="addAmount" name="amount" required>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            <button type="submit" class="btn btn-primary">Add Money</button>
          </div>
        </form>
      </div>
    </div>
  </div>



  <!-- Personal info Section Begin -->
  <section class="checkout spad">
    <div class="container">
      <form action="#" class="checkout__form">
        <div class="row d-flex justify-content-end">
          <div class="path">
            <div class="l">
              <a href="/user-profile">Personal Information</a>
            </div>
            <div class="separator"></div>
            <div>
              <a href="/user-profile/myorders">My Orders</a>
            </div>
            <div class="separator"></div>
            <div>
              <a href="/user-profile/address">Address</a>
            </div>
            <div class="separator"></div>
            <div>
              <a href="/Wallet" style="color: #dc3545;">Wallet</a>
            </div>
            <div class="separator"></div>
            <div>
              <a href="/user-profile/change-password">Change Password</a>
            </div>
            <div class="separator"></div>
            <div>
              <a href="/refferal">Referral</a>
            </div>
            <div class="separator"></div>
          </div>

          <div class="col-lg-8 wallet-container">
            <br>
            <h5 class="d-flex justify-content-center font-weight-bold">Wallet</h5>
            <div class="container ">
                <div class="balance-box">
                  <% if (typeof balance==='number' ) { %>
                    <h3>Wallet Balance: &#x20B9;<%= balance.toFixed(2) %>
                    </h3>
                    <% } else { %>
                      <h3>Wallet Balance: N/A</h3>
                      <% } %>
                </div>

                <% if (messages.success) { %>
                  <div class="alert alert-success flash-message" role="alert" style="color: green;" data-timeout="5">
                    <%= messages.success %>
                  </div>
                  <% } %>

                    <% if (messages.error) { %>
                      <div class="alert alert-danger flash-message" role="alert" style="color: red;" data-timeout="5">
                        <%= messages.error %>
                      </div>
                      <% } %>
                        <div class="transaction-list mt-4">
                          <table class="table table-striped">
                            <thead>
                              <tr>
                                <th scope="col">Transaction Type</th>
                                <th scope="col">Date</th>
                                <th scope="col">Amount</th>
                              </tr>
                            </thead>
                            <tbody>
                              <% transactions.forEach(function(transaction) { %>
                                <tr>
                                  <td>
                                    <%= transaction.transactionMethod %>
                                  </td>
                                  <td>
                                    <%= new Date(transaction.date).toDateString() %>
                                  </td>
                                  <td
                                    class="<%= (transaction.amount >= 0 && ['Credit', 'Refund', 'Referral'].includes(transaction.transactionMethod)) ? 'text-green' : 'text-red' %>">
                                    <% if (transaction.amount>= 0) { %>
                                      <% if (['Payment', 'Razorpay' , 'Debit' ].includes(transaction.transactionMethod))
                                        { %>
                                        -<%= Math.abs(transaction.amount) %>
                                          <% } else { %>
                                            +<%= transaction.amount %>
                                              <% } %>
                                                <% } else { %>
                                                  -<%= Math.abs(transaction.amount) %>
                                                    <% } %>
                                  </td>
                                </tr>
                                <% }) %>
                            </tbody>
                          </table>
                          <!-- Pagination Controls -->
                          <% if (pagination.totalPages> 1) { %>
                            <nav aria-label="Transaction pagination" class="d-flex justify-content-center mt-4">
                              <ul class="pagination">
                                <% if (pagination.hasPrevPage) { %>
                                  <li class="page-item">
                                    <a class="page-link" href="?page=<%= pagination.prevPage %>" aria-label="Previous">
                                      <span aria-hidden="true">&laquo;</span>
                                    </a>
                                  </li>
                                  <% } %>

                                    <% for(let i=1; i <=pagination.totalPages; i++) { %>
                                      <li class="page-item <%= i === pagination.currentPage ? 'active' : '' %>">
                                        <a class="page-link" href="?page=<%= i %>">
                                          <%= i %>
                                        </a>
                                      </li>
                                      <% } %>

                                        <% if (pagination.hasNextPage) { %>
                                          <li class="page-item">
                                            <a class="page-link" href="?page=<%= pagination.nextPage %>"
                                              aria-label="Next">
                                              <span aria-hidden="true">&raquo;</span>
                                            </a>
                                          </li>
                                          <% } %>
                              </ul>
                            </nav>
                            <% } %>
                        </div>
              </div>
            </div>
          </div>
      </form>
    </div>
  </section>

  <%- include('../layouts/user/footer') %>

    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/js/bootstrap.bundle.min.js"></script>


    <script>
      $(document).ready(function () {
        $('#changePasswordBtn').click(function () {
          $('#changePasswordModal').modal('show');
        });
      });
      $(document).ready(function () {
        // Show modal when the "Change Password" button is clicked
        $('#changePasswordBtn').click(function () {
          $('#changePasswordModal').modal('show');
        });

        // Form submission validation
        $('#changePasswordForm').on('submit', function (e) {
          var newPassword = $('#newPassword').val();
          var confirmPassword = $('#confirmPassword').val();
          var passwordMatchError = $('#passwordMatchError');
          var passwordHelp = $('#passwordHelp');

          // Regular expression for a strong password: 
          // at least 8 characters, 1 uppercase, 1 lowercase, 1 number, 1 special character
          var strongPasswordRegex = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{8,}$/;

          // Check if passwords match
          if (newPassword !== confirmPassword) {
            e.preventDefault(); // Stop form submission
            passwordMatchError.show(); // Show the error message
          } else {
            passwordMatchError.hide(); // Hide the error message
          }

          // Check if the password is strong enough
          if (!strongPasswordRegex.test(newPassword)) {
            e.preventDefault(); // Stop form submission
            passwordHelp.text('Password is not strong enough!').addClass('text-danger');
          } else {
            passwordHelp.text('Your password must be 8-20 characters long, contain uppercase and lowercase letters, a number, and a special character.').removeClass('text-danger');
          }
        });
      });
    </script>
    </body>

    </html>