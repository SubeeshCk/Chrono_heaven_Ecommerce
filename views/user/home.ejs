<%- include("../layouts/user/header")-%>

    <!-- Slider -->
    <section class="section-slide">
      <div class="wrap-slick1">
        <div class="slick1">
          <div class="item-slick1" style="background-image: url(/userAssets/images/slide-01.jpeg)">
            <div class="container h-full">
              <div class="flex-col-l-m h-full p-t-100 p-b-30 respon5">
                <div class="layer-slick1 animated visible-false" data-appear="fadeInDown" data-delay="0">
                  <span class="ltext-1011 cl2 respon2">
                    Welcome to the heaven of luxury watch collection.
                  </span>
                </div>

                <div class="layer-slick1 animated visible-false" data-appear="fadeInUp" data-delay="800">
                  <h2 class="ltext-2011 cl2 p-t-19 p-b-43 respon1">
                    THE WHOLE NEW LUXURY COLLECTION
                  </h2>
                </div>

                <div class="layer-slick1 animated visible-false" data-appear="zoomIn" data-delay="1600">
                  <a href="/products" class="flex-c-m stext-101 cl0 size-101 bg1 bor1 hov-btn1 p-lr-15 trans-04">
                    Shop Now
                  </a>
                </div>
              </div>
            </div>
          </div>

          <div class="item-slick1" style="background-image: url(/userAssets/images/slide-02.png)">
            <div class="container h-full">
              <div class="flex-col-l-m h-full p-t-100 p-b-30 respon5">
                <div class="layer-slick1 animated visible-false" data-appear="fadeInDown" data-delay="0">
                  <span class="ltext-101 cl2 respon2"> Men's collection. </span>
                </div>

                <div class="layer-slick1 animated visible-false" data-appear="fadeInUp" data-delay="800">
                  <h2 class="ltext-201 cl2 p-t-19 p-b-43 respon1">New arrivals</h2>
                </div>

                <div class="layer-slick1 animated visible-false" data-appear="zoomIn" data-delay="1600">
                  <a href="/products/mens" class="flex-c-m stext-101 cl0 size-101 bg1 bor1 hov-btn1 p-lr-15 trans-04">
                    Shop Now
                  </a>
                </div>
              </div>
            </div>
          </div>

          <div class="item-slick1" style="background-image: url(/userAssets/images/slide-03.jpg)">
            <div class="container h-full">
              <div class="flex-col-l-m h-full p-t-100 p-b-30 respon5">
                <div class="layer-slick1 animated visible-false" data-appear="fadeInDown" data-delay="0">
                  <span class="ltext-101 cl2 respon2"> Women's collection. </span>
                </div>

                <div class="layer-slick1 animated visible-false" data-appear="fadeInUp" data-delay="800">
                  <h2 class="ltext-201 cl2 p-t-19 p-b-43 respon1">New arrivals</h2>
                </div>

                <div class="layer-slick1 animated visible-false" data-appear="zoomIn" data-delay="1600">
                  <a href="/products/womens" class="flex-c-m stext-101 cl0 size-101 bg1 bor1 hov-btn1 p-lr-15 trans-04">
                    Shop Now
                  </a>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

<!-- Discount Section Begin -->
<section class="discount">
  <div class="container">
    <div class="row">
      <% if (renderData.allActiveOffers.length > 0) { %>
        <div class="col-12">
          <div id="offerSlider" class="carousel slide" data-ride="carousel">
            <div class="carousel-inner">
              <% renderData.allActiveOffers.forEach((offer, index) => { %>
                <div class="carousel-item <%= index === 0 ? 'active' : '' %>">
                  <div class="row">
                    <div class="col-lg-6 p-0">
                      <div class="discount__pic">
                        <% if (offer.imageSource) { %>
                          <img src="<%= offer.imageSource %>" alt="<%= offer.name %> Offer Image">
                        <% } %>
                      </div>
                    </div>
                    <div class="col-lg-6 p-0">
                      <div class="discount__text">
                        <div class="discount__text__title">
                          <h5 style="color: black;">Discount sale</h5>
                          <% if(offer.type === 'product'){ %>
                          <h2>Product on Offer</h2>
                          <h3 style="color: #b67f10;"><%= offer.name %></h3>
                          <h5> <%= offer.discountValue %> % <span>Off</span></h5>
                          <%}else{%>
                            <h3 style="color: #b67f10;"><%= offer.name %>'s collection</h3>
                            <h5> <%= offer.discountValue %> % <span>Off</span></h5>
                            <%}%>
                            <a href="<%= offer.link %>" class="btn mt-3" style="background-color: #cfaa60; color: #fff;">Shop Now</a>
                        </div>
                        <div class="discount__countdown" data-end="<%= offer.endDate %>">
                          <div class="countdown__item">
                            <span class="days">0</span>
                            <p>Days</p>
                          </div>
                          <div class="countdown__item">
                            <span class="hours">0</span>
                            <p>Hours</p>
                          </div>
                          <div class="countdown__item">
                            <span class="minutes">0</span>
                            <p>Minutes</p>
                          </div>
                          <div class="countdown__item">
                            <span class="seconds">0</span>
                            <p>Seconds</p>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              <% }); %>
            </div>
            <% if (renderData.allActiveOffers.length > 1) { %>
              <a class="carousel-control-prev" href="#offerSlider" role="button" data-slide="prev">
                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                <span class="sr-only">Previous</span>
              </a>
              <a class="carousel-control-next" href="#offerSlider" role="button" data-slide="next">
                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                <span class="sr-only">Next</span>
              </a>
            <% } %>
          </div>
        </div>
      <% } %>
    </div>
  </div>
</section>
<!-- Discount Section End -->
 

    <!-- Banner -->
    <div class="sec-banner bg0 p-t-80 p-b-50">
      <div class="container">
        <div class="row">
          <div class="col-md-6 col-xl-4 p-b-30 m-lr-auto">
            <!-- Block1 -->
            <div class="block1 wrap-pic-w">
              <img src="/userAssets/images/banner-01.jpg" alt="IMG-BANNER" />

              <a href="/products/womens"
                class="block1-txt ab-t-l s-full flex-col-l-sb p-lr-38 p-tb-34 trans-03 respon3">
                <div class="block1-txt-child1 flex-col-l">
                  <span class="block1-name ltext-102 trans-04 p-b-8"> Women </span>

                  <span class="block1-info stext-102 trans-04">
                    Latest collection
                  </span>
                </div>

                <div class="block1-txt-child2 p-b-4 trans-05">
                  <div class="block1-link stext-101 cl0 trans-09">Shop Now</div>
                </div>
              </a>
            </div>
          </div>

          <div class="col-md-6 col-xl-4 p-b-30 m-lr-auto">
            <!-- Block1 -->
            <div class="block1 wrap-pic-w">
              <img src="/userAssets/images/banner-02.jpg" alt="IMG-BANNER" />

              <a href="/products/mens" class="block1-txt ab-t-l s-full flex-col-l-sb p-lr-38 p-tb-34 trans-03 respon3">
                <div class="block1-txt-child1 flex-col-l">
                  <span class="block1-name ltext-102 trans-04 p-b-8"> Men </span>

                  <span class="block1-info stext-102 trans-04">
                    Latest collection
                  </span>
                </div>

                <div class="block1-txt-child2 p-b-4 trans-05">
                  <div class="block1-link stext-101 cl0 trans-09">Shop Now</div>
                </div>
              </a>
            </div>
          </div>

          <div class="col-md-6 col-xl-4 p-b-30 m-lr-auto">
            <!-- Block1 -->
            <div class="block1 wrap-pic-w">
              <img src="/userAssets/images/banner-03.jpg" alt="IMG-BANNER" />

              <a href="#" class="block1-txt ab-t-l s-full flex-col-l-sb p-lr-38 p-tb-34 trans-03 respon3">
                <div class="block1-txt-child1 flex-col-l">
                  <span class="block1-name ltext-102 trans-04 p-b-8"> Kids </span>

                  <span class="block1-info stext-102 trans-04">
                    Latest collection
                  </span>
                </div>

                <div class="block1-txt-child2 p-b-4 trans-05">
                  <div class="block1-link stext-101 cl0 trans-09">Shop Now</div>
                </div>
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Product -->
    <section class="bg0 p-t-23 p-b-140">
      <div class="container">
        <div class="p-b-10">
          <h3 class="ltext-103 cl5">Product Overview</h3>
        </div>

        <div class="flex-w flex-sb-m p-b-52">
          <div class="flex-w flex-l-m filter-tope-group m-tb-10" class="menu-desktop">
            <button class="stext-106 cl6 hov1 bor3 trans-04 m-r-32 m-tb-5 how-active1">
              <a href="/products">All Products</a>
            </button>

            <button class="stext-106 cl6 hov1 bor3 trans-04 m-r-32 m-tb-5">
              <a href="/products/womens">Womens collections</a>
            </button>

            <button class="stext-106 cl6 hov1 bor3 trans-04 m-r-32 m-tb-5">
              <a href="/products/mens">Mens collections</a>
            </button>

            <button class="stext-106 cl6 hov1 bor3 trans-04 m-r-32 m-tb-5">
              <a href="/products/kids">kids collections</a>
            </button>

            <div class="dropdown ">
              <button class="stext-106 cl6 hov1 bor3 trans-04 m-r-32 m-tb-5 dropdown-toggle" type="button"
                id="brandDropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                Shop by Brand
              </button>
              <div class="dropdown-menu" aria-labelledby="brandDropdown">
                <a class="dropdown-item" href="/products/?brand=cartier">Cartier</a>
                <a class="dropdown-item" href="/products/?brand=rolex">Rolex</a>
                <a class="dropdown-item" href="/products/?brand=omega">Omega</a>
                <a class="dropdown-item" href="/products/?brand=patek-philippe">Patek Philippe</a>
                <a class="dropdown-item" href="/products/?brand=tag-heuer">Tag Heuer</a>
              </div>
            </div>
          </div>
        </div>

        <div class="row isotope-grid">
          <% if (renderData.productData && renderData.productData.length > 0) { %> 
            <% renderData.productData.forEach(function(product) { %>
              <div class="col-sm-6 col-md-4 col-lg-3 p-b-35 isotope-item women">
                <!-- Block2 -->
                <div class="block2">
                  <div class="block2-pic hov-img0">
                    <img src="/adminAssets/uploads/product_images/<%= product.images[0] %>" alt="IMG-PRODUCT" />
                    <a href="/product-details/<%= product._id %>" class="block2-btn flex-c-m stext-103 cl2 size-102 bg0 bor2 hov-btn1 p-lr-15 trans-04">
                      View
                    </a>
                  </div>
                  <div class="block2-txt flex-w flex-t p-t-14">
                    <div class="block2-txt-child1 flex-col-l">
                      <a href="/product-details/<%= product._id %>" class="product-name stext-104 cl4 hov-cl1 trans-04 js-name-b2 p-b-6" style="text-transform:capitalize;">
                        <%= product.product_name %>
                      </a>
                      
                      <% function formatPriceWithCommas(price) {
                          price = price.toString();
                          let lastThree = price.substring(price.length-3);
                          let otherNumbers = price.substring(0, price.length-3);
                          if (otherNumbers != '') lastThree = ',' + lastThree;
                          let formattedPrice = otherNumbers.replace(/\B(?=(\d{2})+(?!\d))/g, ",") + lastThree;
                          return formattedPrice;
                      } %>
        
                      <!-- Price Section with Line Break for Consistent Layout -->
                      <div class="price-section">
                        <% if (product.hasDiscount) { %>
                          <!-- Original Price (Strikethrough) -->
                          <span class="mtext-106 cl2" style="text-decoration: line-through; color: #888;">
                            ₹<%= formatPriceWithCommas(product.originalPrice) %>
                          </span>
                          <!-- Discounted Price on New Line -->
                          <span class="mtext-110 cl2" style="color: #e95a5c; display: block;">
                            ₹<%= formatPriceWithCommas(product.discountedPrice) %> (<%= Math.round(((product.originalPrice - product.discountedPrice) / product.originalPrice) * 100) %>% off)
                          </span>
                        <% } else { %>
                          <!-- Price without discount -->
                          <span class="mtext-110 cl2">
                            ₹<%= formatPriceWithCommas(product.price) %>
                          </span>
                          <!-- Empty Placeholder Span for Consistency -->
                          <span class="placeholder" style="visibility: hidden; display: block;">&nbsp;</span>
                        <% } %>
                      </div>
        
                      <!-- Rating and Reviews Section on Consistent Fifth Line -->
                      <div class="rating" style="margin-top: 5px; color: #d49311;">
                        <% for (let i = 1; i <= 5; i++) { %>
                          <% if (i <= Math.floor(product.averageRating)) { %>
                            <i class="fa fa-star"></i>
                          <% } else if (i === Math.ceil(product.averageRating) && product.averageRating % 1 !== 0) { %>
                            <i class="fa fa-star-half-o"></i>
                          <% } else { %>
                            <i class="fa fa-star-o"></i>
                          <% } %>
                        <% } %>
                        <span>(<%= product.totalReviews %> reviews)</span>
                      </div>
                    </div>
                    <div class="block2-txt-child2 flex-r p-t-3">
                      <a href="#" class="btn-addwish-b2 dis-block" data-product-id="<%= product._id %>">
                        <% if (locals.wishlistProductIds && locals.wishlistProductIds.has(product._id.toString())) { %>
                          <img class="icon-heart1 dis-block trans-04" src="/userAssets/images/icons/icon-heart-02.png" alt="ICON" />
                        <% } else { %>
                          <img class="icon-heart1 dis-block trans-04" src="/userAssets/images/icons/icon-heart-01.png" alt="ICON" />
                        <% } %>
                      </a>
                    </div>
                  </div>
                </div>
              </div>
            <% }); %>
          <% } else { %>
            <p>No products available.</p>
          <% } %>
        </div>
        
        

        <!-- Load more -->
        <div class="flex-c-m flex-w w-full p-t-45">
          <a href="/products" class="flex-c-m stext-101 cl5 size-103 bg2 bor1 hov-btn1 p-lr-15 trans-04">
            Shop more
          </a>
        </div>
      </div>
    </section>

    <script>
      document.addEventListener('DOMContentLoaded', function() {
        function updateCountdown(countdownElement) {
          const endDate = new Date(countdownElement.dataset.end).getTime();
          
          const updateTimer = () => {
            const now = new Date().getTime();
            const distance = endDate - now;
      
            if (distance < 0) {
              countdownElement.innerHTML = 'EXPIRED';
              return;
            }
      
            const days = Math.floor(distance / (1000 * 60 * 60 * 24));
            const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((distance % (1000 * 60)) / 1000);
      
            countdownElement.querySelector('.days').textContent = days;
            countdownElement.querySelector('.hours').textContent = hours;
            countdownElement.querySelector('.minutes').textContent = minutes;
            countdownElement.querySelector('.seconds').textContent = seconds;
          };
      
          updateTimer();
          return setInterval(updateTimer, 1000);
        }
      
        const countdownElements = document.querySelectorAll('.discount__countdown');
        const intervals = [];
      
        countdownElements.forEach(element => {
          intervals.push(updateCountdown(element));
        });
      
        // Clear intervals when sliding to prevent memory leaks
        $('#offerSlider').on('slide.bs.carousel', function () {
          intervals.forEach(interval => clearInterval(interval));
          intervals.length = 0;
        });
      
        // Restart countdowns after sliding
        $('#offerSlider').on('slid.bs.carousel', function () {
          countdownElements.forEach(element => {
            intervals.push(updateCountdown(element));
          });
        });
      });
      </script>
      
    <%- include("../layouts/user/footer")-%>