
<%- include("../layouts/user/product-header")-%>

    <main class="container">
        <h1>Your Wishlist</h1>
        
        <% if (wishlistItems && wishlistItems.length > 0) { %>
            <div class="wishlist-items">
                <% wishlistItems.forEach(item => { %>
                    <div class="wishlist-item" data-product-id="<%= item.product[0].productId._id %>">
                        <img src="<%= item.product[0].productId.image %>" alt="<%= item.product[0].productId.name %>">
                        <div class="item-details">
                            <h3><%= item.product[0].productId.name %></h3>
                            <p class="price">
                                $<%= item.product[0].discountedPrice.toFixed(2) %>
                                <% if (item.product[0].discountPercent > 0) { %>
                                    <span class="original-price">$<%= item.product[0].productId.price.toFixed(2) %></span>
                                    <span class="discount">(<%= item.product[0].discountPercent %>% off)</span>
                                <% } %>
                            </p>
                            <button class="remove-from-wishlist">Remove</button>
                            <button class="add-to-cart">Add to Cart</button>
                        </div>
                    </div>
                <% }); %>
            </div>
        <% } else { %>
            <p>Your wishlist is empty. Start adding some items!</p>
        <% } %>
    </main>

    <%- include("../layouts/user/footer")-%>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script>
        $(document).ready(function() {
            $('.remove-from-wishlist').on('click', function() {
                const productId = $(this).closest('.wishlist-item').data('product-id');
                $.ajax({
                    url: `/wishlist/remove?productId=${productId}`,
                    method: 'POST',
                    success: function(response) {
                        location.reload();
                    },
                    error: function(xhr, status, error) {
                        console.error('Error removing item from wishlist:', error);
                        alert('Failed to remove item from wishlist. Please try again.');
                    }
                });
            });

            $('.add-to-cart').on('click', function() {
                const productId = $(this).closest('.wishlist-item').data('product-id');
                $.ajax({
                    url: `/cart/add?productId=${productId}`,
                    method: 'POST',
                    success: function(response) {
                        alert('Item added to cart successfully!');
                    },
                    error: function(xhr, status, error) {
                        console.error('Error adding item to cart:', error);
                        alert('Failed to add item to cart. Please try again.');
                    }
                });
            });
        });
    </script>
</body>
</html>