<%- include("../layouts/user/product-header")-%>

<style>

.path {
    display: flex;
    flex-direction: column;
    align-items: start;
    padding: 25px;
    background-color: #f9f9f9;
    border-radius: 8px;
    width: 300px; /* Increased width */
    font-family: Arial, sans-serif;
    margin-right: auto;
    margin-top: 10px;
    margin-bottom: 50px;
    height: 500px;
  }

  /* Link Styling */
  .path a {
    color: #333;
    text-decoration: none;
    font-size: 20px; /* Increased font size */
    font-weight: 300;
    padding: 12px 0; /* Slightly larger padding */
    transition: color 0.3s ease;
  }

  /* Hover and Active Link */
  .path a:hover {
    color: #007bff;
  }
  .path a[style*="color: red;"] {
    color: #dc3545;
  }

  /* Separator Line Styling */
  .path .separator {
    width: 100%;
    height: 1px;
    background-color: #e0e0e0;
    margin: 6px 0;
  }

  /* Profile Container Styling */
  .profile-container {
    background-color: #ffffff;
    border: 1px solid #e0e0e0;
    border-radius: 10px;
    padding: 30px;
    box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.1);
    margin-top: 20px;
    margin-bottom: 30px;
  }

  /* Personal Information Styling */
  .personal-info h5 {
    font-weight: 600;
    font-size: 24px;
    color: #333;
    margin-bottom: 20px;
  }

  .personal-info .info-group {
    font-size: 16px;
    color: #555;
    display: flex;
    flex-direction: column;
    margin-bottom: 10px;
  }

  .personal-info .info-group h6 {
    font-weight: 600;
    color: #333;
  }

  /* Button Styling */
  .btn-edit-profile {
    background-color: #dc3545;
    color: #fff;
    font-weight: 500;
    padding: 10px 20px;
    border-radius: 5px;
    border: none;
    transition: background-color 0.3s ease;
  }

  .btn-edit-profile:hover {
    background-color: #c82333;
  }

  /* Modal Content Styling */
  .modal-content {
    padding: 20px;
    border-radius: 8px;
  }

  .modal-content .modal-title {
    font-size: 20px;
    color: #333;
    font-weight: 600;
  }

  .modal-content .form-group label {
    font-weight: 500;
    color: #555;
  }

  .flash-message {
    padding: 15px;
    margin: 10px 0;
    border: 1px solid #ccc;
    border-radius: 5px;
    position: relative;
    animation: fadeOut 3s forwards; /* Adds a fade-out effect */
}

.flash-message.success {
    background-color: #dff0d8;
    color: #3c763d;
}

.flash-message.error {
    background-color: #f2dede;
    color: #a94442;
}

/* Fade out animation */
@keyframes fadeOut {
    0% { opacity: 1; }
    90% { opacity: 0.2; }
    100% { opacity: 0; }
}

</style>
</head>
<body>

<!-- Breadcrumb Begin -->
<div class="container">
  <div class="bread-crumb flex-w  p-r-15 p-t-30 p-lr-0-lg ">
    <a href="/" class="stext-109 cl8 hov-cl1 trans-04">
      Home
      <i class="fa fa-angle-right m-l-9 m-r-10" aria-hidden="true"></i>
    </a>

    <a href="/user-profile" class="stext-109 cl8 hov-cl1 trans-04">
      User profile
      <i class="fa fa-angle-right m-l-9 m-r-10" aria-hidden="true"></i>
    </a>
    
  </div>
</div>
<!-- Breadcrumb End -->

<!-- Change Password Modal -->
<div class="modal fade" id="changePasswordModal" tabindex="-1" role="dialog" aria-labelledby="changePasswordModalLabel"
  aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="changePasswordModalLabel">Change Password</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <form action="/user-profile/change-password" method="post" id="changePasswordForm">
        <div class="modal-body">
          <div class="form-group">
            <label for="currentPassword">Current Password</label>
            <input type="password" class="form-control" id="currentPassword" name="current_password" required>
          </div>
          <div class="form-group">
            <label for="newPassword">New Password</label>
            <input type="password" class="form-control" id="newPassword" name="new_password" required>
            <small id="passwordHelp" class="form-text text-muted">
              Your password must be minimum 8 characters long, contain uppercase and lowercase letters, a number, and a
              special character.
            </small>
          </div>
          <div class="form-group">
            <label for="confirmPassword">Confirm New Password</label>
            <input type="password" class="form-control" id="confirmPassword" name="confirm_password" required>
            <small id="passwordMatchError" class="form-text text-danger" style="display: none;">
              Passwords do not match!
            </small>
          </div>
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-primary">Save changes</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Personal info Section Begin -->
<section class="checkout spad">
  <div class="container">
    <form action="#" class="checkout__form">
      <div class="row d-flex justify-content-end">
        <div class="path">
          <div class="l">
            <a href="/user-profile"  style="color: #dc3545;" >Personal Information</a>
          </div>
          <div class="separator"></div>
          <div>
            <a href="/user-profile/myorders" >My Orders</a>
          </div>
          <div class="separator"></div>
          <div>
            <a href="/user-profile/address">Address</a>
          </div>
          <div class="separator"></div>
          <div>
            <a href="/Wallet">Wallet</a>
          </div>
          <div class="separator"></div>
          <div>
            <a href="#" id="changePasswordBtn">Change Password</a>
          </div>
          <div class="separator"></div>
          <div>
            <a href="/refferal">Referral</a>
          </div>
          <div class="separator"></div>
        </div>
            
          <!-- Personal Information Section -->
          <div class="col-lg-8 personal-info" style="margin-left: 40px;">
          <br>
          <% if (messages.success) { %>
            <div class="alert alert-success flash-message" role="alert" style="color: green;" data-timeout="5">
              <%= messages.success %>
            </div>
          <% } %>

          <% if (messages.error) { %>
            <div class="alert alert-danger flash-message" role="alert" style="color: red;" data-timeout="5">
              <%= messages.error %>
            </div>
          <% } %>

      <h5>Personal Information</h5>
      <div class="info-group">
        <h6>Full Name:</h6>
        <p><%= userData.name %></p>
      </div>
      <div class="info-group">
        <h6>Email ID:</h6>
        <p><%= userData.email %></p>
      </div>
      <div class="info-group">
        <h6>Mobile Number:</h6>
        <p><%= userData.mobile ? userData.mobile : 'Not Provided' %></p>
      </div>
      <div class="d-flex justify-content-between mt-3">
        <a href="/user-profile/edit-profile" class="btn btn-edit-profile">Edit Profile</a>
      </div>
    </div>
      </div>
    </form>
  </div>
</section>
<!-- Personal info Section End -->

<%- include("../layouts/user/footer")-%>

<!-- Include jQuery and Bootstrap JavaScript at the end of the body to ensure they are loaded after the DOM is ready -->
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/js/bootstrap.bundle.min.js"></script>

<!-- Custom JavaScript to handle the modal trigger -->
<script>
$(document).ready(function () {
  $('#changePasswordBtn').click(function () {
    $('#changePasswordModal').modal('show');
  });
});
$(document).ready(function () {
  // Show modal when the "Change Password" button is clicked
  $('#changePasswordBtn').click(function () {
    $('#changePasswordModal').modal('show');
  });

  // Form submission validation
  $('#changePasswordForm').on('submit', function (e) {
    var newPassword = $('#newPassword').val();
    var confirmPassword = $('#confirmPassword').val();
    var passwordMatchError = $('#passwordMatchError');
    var passwordHelp = $('#passwordHelp');

    // Regular expression for a strong password: 
    // at least 8 characters, 1 uppercase, 1 lowercase, 1 number, 1 special character
    var strongPasswordRegex = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{8,}$/;

    // Check if passwords match
    if (newPassword !== confirmPassword) {
      e.preventDefault(); // Stop form submission
      passwordMatchError.show(); // Show the error message
    } else {
      passwordMatchError.hide(); // Hide the error message
    }

    // Check if the password is strong enough
    if (!strongPasswordRegex.test(newPassword)) {
      e.preventDefault(); // Stop form submission
      passwordHelp.text('Password is not strong enough!').addClass('text-danger');
    } else {
      passwordHelp.text('Your password must be 8-20 characters long, contain uppercase and lowercase letters, a number, and a special character.').removeClass('text-danger');
    }
  });
});

</script>
