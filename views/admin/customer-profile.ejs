<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <title>Customer profile</title>
  <meta http-equiv="x-ua-compatible" content="ie=edge" />
  <meta name="description" content="" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta property="og:title" content="" />
  <meta property="og:type" content="" />
  <meta property="og:url" content="" />
  <meta property="og:image" content="" />
  <!-- Favicon -->
  <link rel="shortcut icon" type="image/x-icon" href="/logo-title.png" />
  <!-- Template CSS -->
  <link href="/adminAssets/css/main.css?v=1.1" rel="stylesheet" type="text/css" />
</head>

<body>
  <div class="screen-overlay"></div>
  <aside class="navbar-aside" id="offcanvas_aside">
    <div class="aside-top">
      <a href="index.html" class="brand-wrap">
        <img src="/userAssets/images/icons/logo-01.png" class="logo" alt="Nest Dashboard" />
      </a>
      <div>
        <button class="btn btn-icon btn-aside-minimize"><i class="text-muted material-icons md-menu_open"></i></button>
      </div>
    </div>
    <nav>
      <ul class="menu-aside">
        <li class="menu-item active">
          <a class="menu-link" href="/admin/Dashboard">
            <i class="icon material-icons md-home"></i>
            <span class="text">Dashboard</span>
          </a>
        </li>
        <li class="menu-item ">
          <a class="menu-link" href="/admin/sales-report">
              <i class="icon material-icons md-account_balance_wallet"></i>
              <span class="text">Sales report</span>
          </a>
      </li>
        <li class="menu-item has-submenu">
          <a class="menu-link">
            <i class="icon material-icons md-shopping_bag"></i>
            <span class="text">Categories</span>
          </a>
          <div class="submenu">
            <a href="/admin/categories">Categories</a>
          </div>
        </li>
        <li class="menu-item has-submenu">
          <a class="menu-link">
            <i class="icon material-icons md-shopping_bag"></i>
            <span class="text">Products</span>
          </a>
          <div class="submenu">
            <a href="/admin/products">Products list</a>
            <a href="/admin/products/add-products">Add product</a>
          </div>
        </li>
        <li class="menu-item has-submenu">
          <a class="menu-link">
            <i class="icon material-icons md-shopping_cart"></i>
            <span class="text">Orders</span>
          </a>
          <div class="submenu">
            <a href="/admin/orders">Orders</a>
            <a href="/admin/return">Return requests</a>
        </div>
        </li>
        <li class="menu-item has-submenu">
          <a class="menu-link" href="/admin/users">
            <i class="icon material-icons md-person"></i>
            <span class="text">Customers</span>
          </a>
          <div class="submenu active">
            <a href="/admin/customers">Customers</a>
          </div>
        </li>
        <li class="menu-item has-submenu ">
          <a class="menu-link" href="#">
              <i class="icon material-icons md-monetization_on"></i>
              <span class="text">Offers & Coupons</span>
          </a>
          <div class="submenu">
              <a href="/admin/category-offers">Category offers</a>
              <a href="/admin/product-offers">Product offers</a>
              <a href="/admin/coupons">Manage Coupons</a>
          </div>
      </li>
        <br />
        <br />
    </nav>
  </aside>

  <main class="main-wrap">
    <header class="main-header navbar">
      <div class="col-search">
          <form class="searchform">
              <div class="input-group">
                  <input type="text" placeholder="Search..." class="form-control" />
                  <button class="btn btn-light bg" type="button"><i class="material-icons md-search"></i></button>
              </div>
          </form>
      </div>
      <div class="col-nav">
          <button class="btn btn-icon btn-mobile me-auto" data-trigger="#offcanvas_aside"><i
                  class="material-icons md-apps"></i></button>
          <ul class="nav">
              <li class="nav-item">
                  <a class="nav-link btn-icon darkmode" href="#"> <i class="material-icons md-nights_stay"></i>
                  </a>
              </li>
              <li class="nav-item">
                  <a href="#" class="requestfullscreen nav-link btn-icon"><i
                          class="material-icons md-cast"></i></a>
              </li>
              <li class="dropdown nav-item">
                  <a class="dropdown-toggle" data-bs-toggle="dropdown" href="#" id="dropdownAccount"
                      aria-expanded="false"> <img class="img-xs rounded-circle"
                          src="/adminAssets/imgs/people/avatar-2.png" alt="User" /></a>
                  <div class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdownAccount">
                      <a class="dropdown-item text-danger" href="/admin/logOut"><i
                              class="material-icons md-exit_to_app"></i>Logout</a>
                  </div>
              </li>
          </ul>
      </div>
  </header>

    <section class="content-main">
      <div class="content-header">
        <a href="/admin/customers"><i class="material-icons md-arrow_back"></i> Go back </a>
      </div>
      <div class="card mb-4">
        <div class="card-body">
          <div class="row">
            <div class="col-xl col-lg">
              <h3>
                <%= customer.name %>
              </h3>
              <p>Email: <%= customer.email %>
              </p>
              <p>Mobile: <%= customer.mobile %>
              </p>
            </div>
          </div>
          <hr class="my-4" />
          <div class="row g-4">
            <div class="col-sm-6 col-lg-4 col-xl-3">
              <h4>Contacts</h4>
              <p>
                Name: <%= customer.name %> <br />
                  Email: <%= customer.email %> <br />
                    Phone: <%= customer.mobile %>
              </p>
            </div>
            <div class="col-sm-6 col-lg-4 col-xl-3">
              <h4>Address</h4>
              <p><% if (addresses && addresses.length > 0) { %>
                     <% addresses.forEach(address => { %>
                     <h6><%= address.addresstype %></h6>
                     <%= address.name %>,<%= address.address %>, <%= address.locality %>, <%= address.city %>, <%= address.pincode %>
                      <% }) %>
                  <% } else { %>
                      <li class="list-group-item" style="color: #000; padding: 20px;">No addresses found.</li>
                  <% } %>
              </p>
            </div>
          </div>
        </div>
      </div>
    </section>

    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
    <script src="/adminAssets/js/vendors/jquery-3.6.0.min.js"></script>
    <script src="/adminAssets/js/vendors/bootstrap.bundle.min.js"></script>
    <script src="/adminAssets/js/vendors/select2.min.js"></script>
    <script src="/adminAssets/js/vendors/perfect-scrollbar.js"></script>
    <script src="/adminAssets/js/vendors/jquery.fullscreen.min.js"></script>
    <script src="/adminAssets/js/main.js?v=1.1" type="text/javascript"></script>

    <script>
      function setLoading(isLoading) {
        const actionSelect = document.querySelector('select.form-select');
        actionSelect.disabled = isLoading;
      }

      function handleActionChange(selectElement, userId, isBlocked) {
        const action = selectElement.value;
        const isBlockedBool = isBlocked === "true";

        console.log(`Action selected: ${action}, UserID: ${userId}, IsBlocked: ${isBlockedBool}`);

        if (action === "block" && !isBlockedBool) {
          handleBlock(userId);
        } else if (action === "unblock" && isBlockedBool) {
          handleUnblock(userId);
        } else if (action === "message") {
          swal("Message", "This feature is not yet implemented", "info");
        } else {
          console.log("No action taken: current state doesn't match the selected action");
        }

        selectElement.value = "";
      }

      async function handleBlock(userId) {
        const confirmation = await confirmAction("block");
        if (confirmation) {
          setLoading(true);
          console.log(`Initiating block request for user: ${userId}`);
          try {
            const response = await fetch("/admin/customers/block", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ userId }),
            });

            const data = await response.json();
            console.log(`Server response for blocking user ${userId}:`, data);

            if (response.ok) {
              swal("Success", data.message || "User blocked successfully", "success")
                .then(() => {
                  location.reload();
                });
            } else {
              swal("Error", data.message || "Failed to block user", "error");
            }
          } catch (error) {
            console.error(`Error in block request for user ${userId}:`, error);
            swal("Error", "An error occurred while blocking the user", "error");
          } finally {
            setLoading(false);
          }
        }
      }

      async function handleUnblock(userId) {
        const confirmation = await confirmAction("unblock");
        if (confirmation) {
          setLoading(true);
          console.log(`Initiating unblock request for user: ${userId}`);
          try {
            const response = await fetch("/admin/customers/unblock", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ userId }),
            });

            const data = await response.json();
            console.log(`Server response for unblocking user ${userId}:`, data);

            if (response.ok) {
              swal("Success", data.message || "User unblocked successfully", "success")
                .then(() => {
                  location.reload();
                });
            } else {
              swal("Error", data.message || "Failed to unblock user", "error");
            }
          } catch (error) {
            console.error(`Error in unblock request for user ${userId}:`, error);
            swal("Error", "An error occurred while unblocking the user", "error");
          } finally {
            setLoading(false);
          }
        }
      }

      async function confirmAction(action) {
        const result = await swal({
          title: `Are you sure you want to ${action} this user?`,
          icon: "warning",
          buttons: true,
          dangerMode: true,
        });
        return result;
      }
    </script>

</body>

</html>