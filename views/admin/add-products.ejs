<%- include("../layouts/admin/header") -%>

    <section class="content-main">
        <div class="row">
            <div class="col-9">
                <div class="content-header">
                    <h2 class="content-title">Add New Product</h2>
                    <% if (messages.success) { %>
                        <div class="alert alert-success" role="alert" style="color: green;">
                            <%= messages.success %>
                        </div>
                        <% } %>

                            <% if (messages.error) { %>
                                <div class="alert alert-danger" role="alert" style="color: red;">
                                    <%= messages.error %>
                                </div>
                                <% } %>
                                    <div>
                                        <a href="/admin/products" class="btn btn-md rounded font-sm hover-up">Back</a>
                                    </div>
                </div>
            </div>
            <div class="col-lg-12">
                <div class="card mb-4">
                    <div class="card-body">
                        <!-- Form to Add Product -->
                        <form id="productForm" method="post" action="/admin/products/add-products"
                            enctype="multipart/form-data">
                            <div class="mb-4">
                                <label for="product_name" class="form-label">Product Name</label>
                                <input type="text" name="name" placeholder="Type here" class="form-control"
                                    id="product_name" required />
                            </div>
                            <div class="mb-4">
                                <label for="brand_name" class="form-label">Brand Name</label>
                                <input type="text" name="brand_name" placeholder="Brand name" class="form-control"
                                    id="brand_name" required />
                            </div>
                            <div class="mb-4">
                                <label for="price" class="form-label">Price</label>
                                <input type="number" name="price" placeholder="Price" class="form-control" id="price"
                                    required min="0" />
                            </div>
                            <div class="mb-4">
                                <label for="quantity" class="form-label">Quantity</label>
                                <input type="number" name="quantity" placeholder="Available quantity"
                                    class="form-control" id="quantity" required min="0" />
                            </div>

                            <!-- Gender Dropdown -->
                            <div class="mb-4">
                                <label for="gender" class="form-label">Gender</label>
                                <select name="gender" class="form-control" id="gender" required>
                                    <option value="">Select Gender</option>
                                    <option value="men">Men</option>
                                    <option value="women">Women</option>
                                </select>
                            </div>

                            <!-- Movement Dropdown -->
                            <div class="mb-4">
                                <label for="movement" class="form-label">Movement</label>
                                <select name="movement" class="form-control" id="movement" required>
                                    <option value="">Select Movement</option>
                                    <option value="automatic">Automatic</option>
                                    <option value="quartz">Quartz</option>
                                    <option value="hand wound">Hand Wound</option>
                                </select>
                            </div>

                            <!-- Size Input -->
                            <div class="mb-4">
                                <label for="size" class="form-label">Size</label>
                                <input type="text" name="size" placeholder="Size (mm)" class="form-control" id="size"
                                    required />
                            </div>

                            <!-- Dial Shape Input -->
                            <div class="mb-4">
                                <label for="dial_shape" class="form-label">Dial shape</label>
                                <select name="dial_shape" class="form-control" id="dial_shape" required>
                                    <option value="">Select dial shape</option>
                                    <option value="round">round</option>
                                    <option value="rectangle">rectangle</option>
                                    <option value="ovel">Ovel</option>
                                </select>
                            </div>

                            <!-- Case Material Dropdown -->
                            <div class="mb-4">
                                <label for="case_material" class="form-label">Case Material</label>
                                <select name="case_material" class="form-control" id="case_material" required>
                                    <option value="">Select Case Material</option>
                                    <option value="platinum">Platinum</option>
                                    <option value="silver">Silver</option>
                                    <option value="steel">Steel</option>
                                    <option value="gold">Gold</option>
                                    <option value="rose gold">Rose Gold</option>
                                </select>
                            </div>

                            <!-- Strap/Bracelet Dropdown -->
                            <div class="mb-4">
                                <label for="strap_bracelet" class="form-label">Strap/Bracelet</label>
                                <select name="strap_bracelet" class="form-control" id="strap_bracelet" required>
                                    <option value="">Select Strap/Bracelet</option>
                                    <option value="strap">Strap</option>
                                    <option value="bracelet">Bracelet</option>
                                </select>
                            </div>

                            <!-- Water Resistance Capacity Input -->
                            <div class="mb-4">
                                <label for="water_resistance_capacity" class="form-label">Water Resistance
                                    Capacity</label>
                                <input type="text" name="water_resistance_capacity"
                                    placeholder="Water resistance (meters)" class="form-control"
                                    id="water_resistance_capacity" required />
                            </div>

                            <!-- Brand Warranty Input -->
                            <div class="mb-4">
                                <label for="brand_warranty" class="form-label">Brand Warranty</label>
                                <input type="text" name="brand_warranty" placeholder="Brand warranty"
                                    class="form-control" id="brand_warranty" required />
                            </div>

                            <!-- Description Textarea -->
                            <div class="mb-4">
                                <label for="description" class="form-label">Description</label>
                                <textarea name="description" placeholder="Product description" class="form-control"
                                    rows="4" required></textarea>
                            </div>

                            <!-- Category Dropdown -->
                            <div class="mb-3">
                                <label for="productCategory" class="form-label">Category</label>
                                <select class="form-control" id="productCategory" name="category" required>
                                    <option value="">Select a category</option>
                                    <% categoryData.forEach(category=> { %>
                                        <option value="<%= category._id %>">
                                            <%= category.name %>
                                        </option>
                                        <% }) %>
                                </select>
                            </div>

                            <!-- Media Section -->
                            <div class="mb-4">
                                <label for="images" class="form-label">Images (Max 4)</label>
                                <input class="form-control" type="file" name="images" id="images" accept="image/*"
                                    multiple required />
                                <div id="imagePreview" class="mt-3 d-flex flex-wrap"></div>
                            </div>

                            <!-- Submit Button -->
                            <div class="mb-4">
                                <button type="submit" class="btn btn-primary">Add Product</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
    </section>

    <script src="/adminAssets/js/vendors/jquery-3.6.0.min.js"></script>
    <script src="/adminAssets/js/vendors/bootstrap.bundle.min.js"></script>
    <script src="/adminAssets/js/main.js"></script>

    <script>
        // Image preview function
        function previewImages(input) {
            const preview = document.getElementById('imagePreview');
            preview.innerHTML = ''; // Clear existing previews

            if (input.files) {
                [...input.files].forEach(file => {
                    if (file.type.startsWith('image/')) {
                        const reader = new FileReader();
                        reader.onload = (e) => {
                            const img = document.createElement('img');
                            img.src = e.target.result;
                            img.className = 'img-thumbnail m-1';
                            img.style.width = '300px';
                            img.style.height = '500px';
                            img.style.objectFit = 'cover';
                            preview.appendChild(img);
                        }
                        reader.readAsDataURL(file);
                    }
                });
            }
        }

        // Validate that no more than 4 images are uploaded and only accept JPEG/PNG files
        document.getElementById('images').addEventListener('change', function () {
            const validImageTypes = ['image/jpeg', 'image/png', 'image/jpg'];
            const files = this.files;

            // Check the number of files
            if (files.length > 4) {
                alert("You can upload a maximum of 4 images.");
                this.value = ''; // Clear the input if more than 4 files are selected
                return;
            }

            // Check each file's type
            for (let i = 0; i < files.length; i++) {
                if (!validImageTypes.includes(files[i].type)) {
                    alert("Only JPEG and PNG images are allowed.");
                    this.value = ''; // Clear the input if any invalid file is found
                    return;
                }
            }

            // Preview images if validation passes
            previewImages(this);
        });

        // ... (rest of the JavaScript validation code remains the same) ...
    </script>


    </body>

    </html>